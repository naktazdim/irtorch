Graded Response Model のパラメータ推定 (MAP推定)

[発狂BMS難度推定](http://walkure.net/hakkyou/index.html) 用

# usage  
```sh
$ python main.py RESPONSE_CSV [--level LEVEL_CSV]
                 [--n-iter N_ITER] [--patience PATIENCE] [--batch_size BATCH_SIZE] 
                 [--out-dir OUT_DIR] [--log-dir LOG_DIR]
```


## 入力ファイル

### RESPONSE_CSV

以下のようなcsvファイルのパスを指定。

| カラム名 | 説明 | 備考 | [発狂BMS難度推定](http://walkure.net/hakkyou/index.html)では |
|-------:|:-----|------|------|
|item|項目の識別子|項目ごとに一意であれば何でもよい|譜面|
|person|被検者の識別子|被検者ごとに一意であれば何でもよい|プレイヤ|
|response|被検者の項目に対する反応|1以上の整数|クリアランプ (FAILED 1, EASY 2, NORMAL 3, HARD 4, FC 5)|

```
(例)
item,person,response
i1,p1,1
i1,p2,3
i2,p1,2
i3,p1,2
...
```

「譜面 i1 にプレイヤ p1 がつけたクリアランプは 1 (FAILED)」……など。

### LEVEL_CSV

音楽ゲームでは、譜面ごとに人手で難易度がつけられていて、それが既知であることが多い。なのでそれも推定に用いることができるようにした。人手でつけられた難易度が同じである譜面は、多少のばらつきがあるにせよ大体同じ難易度であろう、ということ。(正確には、bの事前分布が「人手でつけた難易度」ごとに異なると想定して、それもパラメータとして推定するような階層ベイズモデル)

不要であれば指定する必要はない。

| カラム名 | 説明           | 備考                                                         | [発狂BMS難度推定](http://walkure.net/hakkyou/index.html)では |
| -------- | -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| item     | 項目の識別子   | response_csvのitemと統一すること。すべてのitemが登場する必要はない。同じitemが複数回登場した場合は最初の1つのみが使用される | 譜面                                                         |
| level    | 難易度の識別子 | 難易度ごとに一意であれば何でもよい                           | 難易度表でのレベル (★3, ★★1 etc.)                            |

```
(例)
item,level
i1,★3
i2,★2
i3,★???
```

## 出力ファイル

引数で指定した OUT_DIR (デフォルトはカレントディレクトリ) 以下に出力される。

### a.csv

| カラム名 | 説明                       | 備考                             | [発狂BMS難度推定](http://walkure.net/hakkyou/index.html)では |
| -------- | -------------------------- | -------------------------------- | ------------------------------------------------------------ |
| item     | 項目の識別子               | RESPONSE_CSVで指定したものと同一 | 譜面                                                         |
| a        | 識別力パラメータa の推定値 |                                  | 地力譜面度                                                   |

### b.csv

| カラム名 | 説明                        | 備考                             | [発狂BMS難度推定](http://walkure.net/hakkyou/index.html)では |
| -------- | --------------------------- | -------------------------------- | ------------------------------------------------------------ |
| item     | 項目の識別子                | RESPONSE_CSVで指定したものと同一 | 譜面                                                         |
| grade    | 段階                        | 2以上の数値                      | EASY 2, NORMAL 3, HARD 4, FC 5                               |
| b        | 困難度パラメータ b の推定値 |                                  | 譜面の推定難度                                               |

### t.csv

| カラム名 | 説明                        | 備考                             | [発狂BMS難度推定](http://walkure.net/hakkyou/index.html)では |
| -------- | --------------------------- | -------------------------------- | ------------------------------------------------------------ |
| person   | 被検者の識別子              | RESPONSE_CSVで指定したものと同一 | プレイヤ                                                     |
| t        | 被験者パラメータ θ の推定値 |                                  | 実力推定値 (「あなたの実力」)                                |



### b_prior.csv

LEVEL_CSVを指定したときのみ出力される。見なくてよい。

| カラム名 | 説明                                |
| -------- | ----------------------------------- |
| level    | 難易度の識別子                      |
| grade    | 段階                                |
| mean     | bの事前分布 N(μ, σ^2) の μ の推定値 |
| std      | bの事前分布 N(μ, σ^2) の σ の推定値 |



## ログファイル

引数で指定した LOG_DIR (デフォルトはカレントディレクトリ) 以下に出力される。
以下のようにして http://localhost:6006/ で学習ログをグラフで見ることができる。

```sh
$ tensorboard --logdir LOG_DIR/lightning_logs/version_0/
$ # 末尾の数字 _0 はログディレクトリを消さずに再実行すると _1, _2, と増えていく
```


